{% include 'layout.html' %}
<link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/index.css') }}">
{% block content %}
<div class="container">
	<div id="carouselExampleCaptions" class="carousel slide" data-ride="carousel">
		<ol class="carousel-indicators">
			<li data-target="#carouselExampleCaptions" data-slide-to="0" class="active"></li>
			<li data-target="#carouselExampleCaptions" data-slide-to="1"></li>
			<li data-target="#carouselExampleCaptions" data-slide-to="2"></li>
		</ol>
		<div class="carousel-inner">
			<div class="carousel-item active">
				<img src="{{url_for('static', filename='images/slide1.png')}}" class="d-block w-100" alt="...">
			</div>
			<div class="carousel-item">
				<img src="{{url_for('static', filename='images/slide2.jpg')}}" class="d-block w-100 h-10" alt="...">
			</div>
			<div class="carousel-item">
				<img src="{{url_for('static', filename='images/slide3.png')}}" class="d-block w-100" alt="...">
			</div>
		</div>
		<a class="carousel-control-prev" href="#carouselExampleCaptions" role="button" data-slide="prev">
			<span class="carousel-control-prev-icon" aria-hidden="true"></span>
			<span class="sr-only">Previous</span>
		</a>
		<a class="carousel-control-next" href="#carouselExampleCaptions" role="button" data-slide="next">
			<span class="carousel-control-next-icon" aria-hidden="true"></span>
			<span class="sr-only">Next</span>
		</a>
	</div>
</div>
<br>
<div class="container">
	<div class="outer">
		<div class="inner">{{days}} days passed since First Corona case in India was reported (30th January, 2020)</div>
	</div>
	<br>
	<div class="row">
		<div class="col-md-4">
			<div class="card text-center" style="background-color: blue;">
				<div class="card-header">
					Total Confirmed Cases
				</div>
				<div class="card-body">
					<div class="count">
						<div class="count-left">{{tc}}</div>
						<div class="count-right">{{dc}}</div>
					</div>
					<div class="content">
						<div class="content-left">Total</div>
						<div class="content-right">New</div>
					</div>
				</div>
			</div>
			<div class="card-side">
				<div class="card-side-left">
				</div>
				<div class="card-side-right">
					{{_ci}}% <i class="fas fa-arrow-up" style="font-size: 14px;"></i>
				</div>
			</div>
		</div>

		<div class="col-md-4">
			<div class="card text-center" style="background-color: #29A746;">
				<div class="card-header">
					Total Recovered Cases
				</div>
				<div class="card-body">
					<div class="count">
						<div class="count-left">{{tr}}</div>
						<div class="count-right">{{dr}}</div>
					</div>
					<div class="content">
						<div class="content-left">Recovered</div>
						<div class="content-right">New</div>
					</div>
				</div>
			</div>
			<div class="card-side">
				<div class="card-side-left">
				</div>
				<div class="card-side-right">
					{{_ri}}% <i class="fas fa-arrow-up" style="font-size: 14px;"></i>
				</div>
			</div>
		</div>

		<div class="col-md-4">
			<div class="card text-center" style="background-color: #6D767E;">
				<div class="card-header">
					Total Deceased Cases
				</div>
				<div class="card-body">
					<div class="count">
						<div class="count-left">{{td}}</div>
						<div class="vl"></div>
						<div class="count-right">{{dd}}</div>
					</div>
					<div class="content">
						<div class="content-left">Deceased</div>
						<div class="content-right">New</div>
					</div>
				</div>
			</div>
			<div class="card-side">
				<div class="card-side-left">
				</div>
				<div class="card-side-right">
					{{_di}}% <i class="fas fa-arrow-up" style="font-size: 14px;"></i>
				</div>
			</div>
		</div>
	</div>

	<div class="row">
		<div class="col-xs-12 col-sm-12 col-md-6 col-lg-6"><canvas id="dailyConfirmed"></canvas></div>
		<div class="col-xs-12 col-sm-12 col-md-6 col-lg-6"><canvas id="totalConfirmed"></canvas></div>
	</div>
	<div class="row">
		<div class="col-xs-12 col-sm-12 col-md-6 col-lg-6"><canvas id="dailyRecovered"></canvas></div>
		<div class="col-xs-12 col-sm-12 col-md-6 col-lg-6"><canvas id="totalRecovered"></canvas></div>
	</div>
	<div class="row">
		<div class="col-xs-12 col-sm-12 col-md-6 col-lg-6"><canvas id="dailyDeceased"></canvas></div>
		<div class="col-xs-12 col-sm-12 col-md-6 col-lg-6"><canvas id="totalDeceased"></canvas></div>
	</div>
</div>
<br>
<div class="container">
	<div class="row text-center">
		<div class="col-xs-12 col-sm-12 col-md-4"></div>
		<div class="col-xs-12 col-sm-12 col-md-4">
			<select id="state" name="state" class="form-control" onchange="displayGraph()" style="background-color: orange; color: white; font-weight: bold;">
				<option>Select State</option>
			</select>
		</div>
		<div class="col-xs-12 col-sm-12 col-md-4"></div>
	</div>
	<div class="row" id="state-graph-1"></div><br>
	<div class="row" id="state-graph-2"></div><br>
	<div id="state-data"></div>
</div>
<script>
	Chart.defaults.global.responsive = false;
	var data = JSON.parse({{ data | tojson | safe }});
	var state = {{ state | tojson | safe }};
	local_dates = [];
	for(var i=0; i<data['date'].length; i++)
		local_dates.push(moment(new Date(data['date'][i]), "'YYYY-MM-DD'").format('YYYY-MM-DD').toLocaleString());

	const options = { 
		responsive: true,
		maintainAspectRatio: true,
		aspectRatio: 1.5,
		scales: {
			xAxes: [{
				type: 'time'
			}]
		}
	};

	const ctx_dc = document.getElementById('dailyConfirmed').getContext('2d');
	const ctx_tc = document.getElementById('totalConfirmed').getContext('2d');
	const ctx_dr = document.getElementById('dailyRecovered').getContext('2d');
	const ctx_tr = document.getElementById('totalRecovered').getContext('2d');
	const ctx_dd = document.getElementById('dailyDeceased').getContext('2d');
	const ctx_td = document.getElementById('totalDeceased').getContext('2d');
	
	var chart_dc, chart_tc, chart_dr, chart_tr, chart_dd, chart_dd, chart_td, state_confirmed, state_active, state_recovered, state_deceased;

	const plotChart = (chart, ctx, label, type, color, options) => {
		chart = new Chart(ctx, {
			type: 'line',
			data: {
				labels: local_dates,
				datasets: [{
					label: label,
					data: data[type],
					backgroundColor: [color],
					borderColor: [color],
					borderWidth: 2,
				}]
			},
			options: options,
		});
	}
	// Daily Confirmed
	plotChart(chart_dc, ctx_dc, 'Daily Confirmed', 'dailyconfirmed', '#FF093C', options);
	// Total Confirmed
	plotChart(chart_tc, ctx_tc, 'Total Confirmed', 'totalconfirmed', '#FF093C', options);
	// Daily Recovered
	plotChart(chart_dr, ctx_dr, 'Daily Recovered', 'dailyrecovered', '#29A746', options);
	// Total Recovered
	plotChart(chart_tr, ctx_tr, 'Total Recovered', 'totalrecovered', '#29A746', options);
	// Daily Deceased
	plotChart(chart_dd, ctx_dd, 'Daily Deceased', 'dailydeceased', '#6D767E', options);
	// Total Deceased
	plotChart(chart_td, ctx_td, 'Daily Deceased', 'totaldeceased', '#6D767E', options);

	for(var i=0; i<state.length; i++) {
	    $('<option value="'+state[i].state+'">' + state[i].state + '</option>').appendTo('#state');
	}

	const plotStateChart = (chart, ctx, districts, label, count, color) => {
		chart = new Chart(ctx, {
			type: 'bar',
			data: {
				labels: districts,
				datasets: [{
					label: label,
					data: count,
					backgroundColor: color,
					borderColor: [color],
					strokeColor: [color],
					borderWidth: 2,
				}]
			},
			options: {
				responsive: true,
				maintainAspectRatio: true,
				aspectRatio: 1.4,
			},
		});
	}

	const displayGraph = () => {
		document.getElementById("state-graph-1").innerHTML = `
			<div class="col-xs-12 col-sm-12 col-md-6 col-lg-6"><canvas id="stateConfirmed"></canvas></div>
			<div class="col-xs-12 col-sm-12 col-md-6 col-lg-6"><canvas id="stateRecovered"></canvas></div>
		`;
		document.getElementById("state-graph-2").innerHTML = `
			<div class="col-xs-12 col-sm-12 col-md-6 col-lg-6"><canvas id="stateActive"></canvas></div>
			<div class="col-xs-12 col-sm-12 col-md-6 col-lg-6"><canvas id="stateDeceased"></canvas></div>
		`;
		const stc = document.getElementById('stateConfirmed').getContext('2d');
		const sta = document.getElementById('stateActive').getContext('2d');
		const str = document.getElementById('stateRecovered').getContext('2d');
		const std = document.getElementById('stateDeceased').getContext('2d');

		for(var i=0; i<state.length; i++) {
			if(state[i].state===document.getElementById('state').value){
				districts = [], active = [], recovered = [], confirmed = [], deceased = [];
				for(var j=0; j<state[i].districtData.length; j++){
					if(state[i].districtData[j].district === 'Other States')
						state[i].districtData[j].district = 'Unkown';
					districts.push(state[i].districtData[j].district);
					active.push(state[i].districtData[j].active);
					confirmed.push(state[i].districtData[j].confirmed);
					recovered.push(state[i].districtData[j].recovered);
					deceased.push(state[i].districtData[j].deceased);
				}
				plotStateChart(state_confirmed, stc, districts, 'Confirmed Cases', confirmed, '#0000F7');
				plotStateChart(state_active, sta, districts, 'Active Cases', active, '#FF093C');
				plotStateChart(state_recovered, str, districts, 'Recovered Cases', recovered, '#29A746');
				plotStateChart(state_deceased, std, districts, 'Deceased Cases', deceased, '#6A727A');
				// document.getElementById('state-data').innerHTML = `
				// 	<div class="outer">
				// 		<div class="inner">Total ${districts.length} districts affected in ${state[i].state}</div>
				// 	</div>
				// 	<br>
				// 	<table class="table table-bordered table-striped table-dark" id="state-data-table">
				// 		<thead>
				// 		    <tr>
				// 		      <th scope="col">State</th>
				// 		      <th scope="col">Confirmed</th>
				// 		      <th scope="col">Active</th>
				// 		      <th scope="col">Recovered</th>
				// 		      <th scope="col">Deceased</th>
				// 		    </tr>
				// 		</thead>
				// 		<tbody>
				// 		</tbody>
				// 	</table>
				// `;
				// var cs = 0, as = 0, rs = 0, ds = 0;
				// for(var i=0; i<districts.length; i++){
				// 	cs+=confirmed[i];
				// 	as+=active[i];
				// 	rs+=recovered[i];
				// 	ds+=deceased[i];
				// 	$('#state-data-table').append(`
				// 		<tr>
	   //    					<th scope="row">${districts[i]}</th>
	   //    					<td>${confirmed[i]}</td>
	   //    					<td>${active[i]}</td>
	   //    					<td>${recovered[i]}</td>
	   //    					<td>${deceased[i]}</td>
	   //    				</tr>
				// 	`);
				// }
				// $('#state-data-table').append(`
				// 	<tr>
    //   					<th scope="row">Total</th>
    //   					<td style="font-weight: bold;">${cs}</td>
    //   					<td style="font-weight: bold;">${as}</td>
    //   					<td style="font-weight: bold;">${rs}</td>
    //   					<td style="font-weight: bold;">${ds}</td>
    //   				</tr>
				// `);
			}
		}
	}

</script>
{% endblock %}